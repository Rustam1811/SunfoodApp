<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –±–æ–Ω—É—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: #2a2a2a; padding: 20px; margin: 20px 0; border-radius: 10px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        pre { background: #333; padding: 10px; border-radius: 5px; overflow-x: auto; }
        input { background: #333; color: white; border: 1px solid #555; padding: 8px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ –¢–µ—Å—Ç –±–æ–Ω—É—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã SunfoodApp</h1>
        
        <div class="section">
            <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <input type="text" id="userId" placeholder="User ID" value="+77071234567" style="width: 200px;">
            <button onclick="checkUserData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <div id="userData"></div>
        </div>

        <div class="section">
            <h2>–¢–µ—Å—Ç–æ–≤–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤</h2>
            <input type="number" id="bonusAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–Ω—É—Å–æ–≤" value="50" style="width: 150px;">
            <button onclick="addTestBonus()">–î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å—ã</button>
            <div id="addResult"></div>
        </div>

        <div class="section">
            <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ API user-bonus</h2>
            <button onclick="checkUserBonusAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/user-bonus</button>
            <div id="userBonusResult"></div>
        </div>

        <div class="section">
            <h2>–°–∏–º—É–ª—è—Ü–∏—è –∑–∞–∫–∞–∑–∞ (–ø—Ä–æ—Å—Ç–æ–π API)</h2>
            <input type="number" id="orderAmount" placeholder="–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞" value="1000" style="width: 150px;">
            <button onclick="simulateOrder()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑</button>
            <button onclick="simulateSimpleOrder()">–ü—Ä–æ—Å—Ç–æ–π API –∑–∞–∫–∞–∑</button>
            <div id="orderResult"></div>
        </div>
    </div>

    <script>
        const apiBase = window.location.origin;

        async function checkUserData() {
            const userId = document.getElementById('userId').value;
            const resultDiv = document.getElementById('userData');
            
            try {
                resultDiv.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
                
                const response = await fetch(`${apiBase}/api/test-bonus?userId=${encodeURIComponent(userId)}`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        async function addTestBonus() {
            const userId = document.getElementById('userId').value;
            const amount = parseInt(document.getElementById('bonusAmount').value);
            const resultDiv = document.getElementById('addResult');
            
            try {
                resultDiv.innerHTML = '<p>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤...</p>';
                
                const response = await fetch(`${apiBase}/api/test-bonus?userId=${encodeURIComponent(userId)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ ${data.message}</h3>
                            <p>–°—Ç–∞—Ä—ã–π –±–∞–ª–∞–Ω—Å: ${data.oldBalance}</p>
                            <p>–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${data.newBalance}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        async function checkUserBonusAPI() {
            const userId = document.getElementById('userId').value;
            const resultDiv = document.getElementById('userBonusResult');
            
            try {
                resultDiv.innerHTML = '<p>–ü—Ä–æ–≤–µ—Ä–∫–∞ API...</p>';
                
                const response = await fetch(`${apiBase}/api/user-bonus?userId=${encodeURIComponent(userId)}`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ API user-bonus —Ä–∞–±–æ—Ç–∞–µ—Ç</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ API: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        async function simulateOrder() {
            const userId = document.getElementById('userId').value;
            const amount = parseInt(document.getElementById('orderAmount').value);
            const resultDiv = document.getElementById('orderResult');
            
            try {
                resultDiv.innerHTML = '<p>–°–∏–º—É–ª—è—Ü–∏—è –∑–∞–∫–∞–∑–∞...</p>';
                
                const response = await fetch(`${apiBase}/api/orders`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId,
                        items: [{ name: '–¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫', price: amount, quantity: 1, id: 1 }],
                        amount,
                        bonusUsed: 0
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω</h3>
                            <p>–ù–∞—á–∏—Å–ª–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${data.bonusEarned}</p>
                            <p>–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${data.multiplier}</p>
                            <p>–£—Ä–æ–≤–µ–Ω—å: ${data.level}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–∫–∞–∑–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        async function simulateSimpleOrder() {
            const userId = document.getElementById('userId').value;
            const amount = parseInt(document.getElementById('orderAmount').value);
            const resultDiv = document.getElementById('orderResult');
            
            try {
                resultDiv.innerHTML = '<p>–°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞...</p>';
                
                const response = await fetch(`${apiBase}/api/simple-order`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId,
                        items: [{ name: '–¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫', price: amount, quantity: 1, id: 1 }],
                        amount,
                        bonusUsed: 0
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω</h3>
                            <p>–ù–∞—á–∏—Å–ª–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${data.bonusEarned}</p>
                            <p>–°—Ç–∞—Ä—ã–π –±–∞–ª–∞–Ω—Å: ${data.oldBalance}</p>
                            <p>–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${data.newBalance}</p>
                            <p>ID –∑–∞–∫–∞–∑–∞: ${data.orderId}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            checkUserData();
        };
    </script>
</body>
</html>
